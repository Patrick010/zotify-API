# Proposal: Adaptation of TRACE_INDEX.yml Schema

**Date:** 2025-09-25
**Author:** Jules
**Status:** Proposed & Implemented

## 1. Problem Statement

The initial version of the `TRACE_INDEX.yml` file, generated by the `repo_inventory_and_governance.py` script, had an inconsistent schema. Specifically, the `index` field was only present for artifacts that were expected to be registered in an index. Files classified as `exempt` did not have this field, making the schema non-uniform. This inconsistency makes parsing and programmatic use of the `TRACE_INDEX.yml` more complex than necessary.

## 2. Proposed Solution

This document proposes and describes the implementation of a schema adaptation for `TRACE_INDEX.yml` to make it fully uniform and more robust for programmatic access.

### 2.1. How It Works

The `repo_inventory_and_governance.py` script has been modified to enforce the following new schema rules for every artifact entry in `TRACE_INDEX.yml`:

1.  **Uniform `index` Field:** Every artifact, regardless of its registration status (`true`, `false`, or `exempted`), will now have an `index` field.
2.  **Content of `index` Field:**
    *   For artifacts that are `registered: true` or `registered: false`, the `index` field contains a list of all index files where the artifact is *expected* to be found.
    *   For artifacts that are `registered: exempted`, the `index` field contains an empty list (`[]`).
3.  **`missing_from` Field:** The `missing_from` field remains unchanged and will only be present when `registered: false`, explicitly listing the indexes where the artifact is missing.

### Example of the New Schema:

```yaml
artifacts:
- path: .gitignore
  type: exempt
  registered: exempted
  index: []

- path: api/docs/usage.md
  type: doc
  registered: true
  index:
    - api/docs/MASTER_INDEX.md
    - api/docs/DOCS_QUALITY_INDEX.md

- path: api/docs/overview.md
  type: doc
  registered: false
  index:
    - api/docs/MASTER_INDEX.md
    - api/docs/DOCS_QUALITY_INDEX.md
  missing_from:
    - api/docs/DOCS_QUALITY_INDEX.md
```

## 3. Benefits

-   **Schema Uniformity:** The `TRACE_INDEX.yml` file now has a consistent structure for all artifacts, simplifying parsing and validation.
-   **Improved Programmatic Access:** Consumers of this file can now reliably expect the `index` field to be present for every entry, eliminating the need for conditional checks.
-   **Enhanced Clarity:** The schema is now more explicit, as the `index` field clearly shows the expected indexes for any given file.

## 4. High-Level Implementation Plan

The following changes were made to `scripts/repo_inventory_and_governance.py`:

1.  **Refactor Main Loop:** The main loop that processes files was refactored to construct the `trace_entry` dictionary in a more organized manner.
2.  **Enforce `index` Field:** Logic was added to ensure the `index` field is always populated for every artifact according to the rules described above.
3.  **No Change to Auditing:** The audit report generation was unaffected, as it primarily relies on the `registered` and `missing_from` fields.

## 5. Security Considerations

This change is purely a schema adaptation for a generated data file and has no direct security implications.

## 6. Architectural Impact

This change improves the robustness and maintainability of the project's "Living Documentation" framework by making its primary data artifact, `TRACE_INDEX.yml`, more consistent and easier to consume by other tools.